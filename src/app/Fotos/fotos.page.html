<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Productos
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-searchbar placeholder="Buscar productos..." (ionInput)="onSearch($event)"></ion-searchbar>
  <!-- Formulario para agregar nuevo producto -->
  <ion-card class="add-product-card">
    <ion-card-header>
      <ion-card-title>Agregar Nuevo Producto</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <form [formGroup]="newProductForm">
        <ion-item>
          <ion-label position="stacked">Nombre</ion-label>
          <ion-input formControlName="name" type="text"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Precio (COP)</ion-label>
          <ion-input formControlName="price" type="number" min="0"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">URL de Imagen</ion-label>
          <ion-input formControlName="image" type="url"></ion-input>
        </ion-item>
        <ion-button expand="block" type="button" (click)="addNewProduct()" [disabled]="newProductForm.invalid" color="primary">
          Agregar Producto
        </ion-button>
      </form>
    </ion-card-content>
  </ion-card>

  <!-- Lista de productos -->
  <ion-grid>
    <ion-row>
      <ion-col size="6" *ngFor="let product of filteredProducts$ | async">
        <ion-card>
          <ion-img [src]="product.image"></ion-img>
          <ion-card-header>
            <ion-card-title>{{ product.name }}</ion-card-title>
            <ion-card-subtitle>COP {{ product.price | number:'1.2-2' }}</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <ion-button expand="block" (click)="addToCart(product)">
              Agregar al carrito
            </ion-button>
            <ion-button *ngIf="currentUser && product.userId === currentUser.uid" expand="block" color="danger" (click)="deleteProduct(product)">
              Eliminar Producto
            </ion-button>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-fab vertical="bottom" horizontal="center" slot="fixed">
    <ion-fab-button (click)="addPhotoToGallery()">
      <ion-icon name="camera"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
